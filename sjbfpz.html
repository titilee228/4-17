<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据播发配置</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
    <!-- Element UI -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 替换本地图标字体为在线CDN -->
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2277842_s646dub1bj.css">
    <!-- 添加 Font Awesome 作为备用图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #000B30 0%, #061B82 100%) fixed;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
            position: relative;
            width: 1920px;
            height: 1080px;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(rgba(22, 72, 163, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(22, 72, 163, 0.3) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: -1;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
        }

        .top-nav {
            height: 60px;
            background-color: rgba(6, 27, 130, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid rgba(50, 145, 198, 0.5);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
        }

        .system-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px rgba(50, 145, 198, 0.7);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            letter-spacing: 0.1em;
        }

        .user-info {
            position: absolute;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info span {
            display: flex;
            align-items: center;
        }

        .user-info i {
            margin-right: 5px;
        }

        .logout-btn {
            background-color: rgba(50, 145, 198, 0.3);
            color: white;
            border: 1px solid #3291C6;
            border-radius: 4px;
            padding: 5px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .logout-btn:hover {
            background-color: rgba(50, 145, 198, 0.7);
            box-shadow: 0 0 10px rgba(50, 145, 198, 0.7);
        }

        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background-color: rgba(6, 27, 130, 0.7);
            padding: 20px 0;
            border-right: 1px solid rgba(50, 145, 198, 0.3);
            overflow-y: auto;
        }

        .menu-title {
            font-size: 16px;
            font-weight: bold;
            color: #3291C6;
            padding: 10px 20px;
            border-bottom: 1px solid rgba(50, 145, 198, 0.3);
            margin-bottom: 15px;
        }

        .menu-item {
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .menu-item i {
            margin-right: 10px;
            color: #4dabf7;
        }

        .menu-item:hover {
            background-color: rgba(50, 145, 198, 0.3);
            color: white;
        }

        .menu-item.active {
            background-color: rgba(50, 145, 198, 0.5);
            color: white;
            border-left: 3px solid #3291C6;
        }

        .main-content {
            flex: 1;
            padding: 15px;
            overflow: hidden;
            height: calc(100vh - 60px);
            background-color: rgba(0, 11, 48, 0.3);
            display: flex;
            flex-direction: column;
        }

        .data-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            overflow: hidden;
            background-color: transparent !important;
        }

        .section-container {
            background: rgba(6, 27, 130, 0.5);
            border: 1px solid rgba(50, 145, 198, 0.3);
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: none;
            margin: 0;
            width: 100%;
            box-sizing: border-box;
        }
        
        .section-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .section-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(50, 145, 198, 0.05) 25%, transparent 25%, transparent 50%, rgba(50, 145, 198, 0.05) 50%, rgba(50, 145, 198, 0.05) 75%, transparent 75%, transparent);
            background-size: 4px 4px;
            pointer-events: none;
            z-index: -1;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            color: #3291C6;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(50, 145, 198, 0.3);
            position: relative;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(50, 145, 198, 0.3);
        }

        .section-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background: #3291C6;
        }

        .section-title i {
            margin-right: 8px;
            color: #4dabf7;
        }

        /* 表格样式 */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        thead {
            background: rgba(13, 32, 64, 0.8);
        }

        th {
            text-align: left;
            padding: 10px 15px;
            font-weight: normal;
            color: #3291C6;
            border-bottom: 1px solid rgba(50, 145, 198, 0.3);
            font-size: 14px;
        }

        td {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(50, 145, 198, 0.1);
            font-size: 14px;
        }

        tbody tr {
            transition: all 0.3s;
        }

        tbody tr:hover {
            background: rgba(50, 145, 198, 0.1);
        }

        /* 按钮样式 */
        .btn {
            padding: 6px 12px;
            background: rgba(50, 145, 198, 0.2);
            color: #e0e0e0;
            border: 1px solid rgba(50, 145, 198, 0.5);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn:hover {
            background: rgba(50, 145, 198, 0.4);
            border-color: rgba(50, 145, 198, 0.8);
            box-shadow: 0 0 5px rgba(50, 145, 198, 0.5);
        }

        .btn-primary {
            background: rgba(50, 145, 198, 0.5);
            color: white;
            border-color: rgba(50, 145, 198, 0.8);
        }

        .btn-primary:hover {
            background: rgba(50, 145, 198, 0.7);
            box-shadow: 0 0 8px rgba(50, 145, 198, 0.7);
        }

        .btn-text {
            background: none;
            border: none;
            color: #4dabf7;
            cursor: pointer;
            padding: 3px 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-text:hover {
            color: white;
            text-shadow: 0 0 5px rgba(77, 171, 247, 0.7);
        }

        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(13, 32, 64, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(77, 171, 247, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(77, 171, 247, 0.8);
        }

        /* 状态指示器 */
        .status-active {
            color: #67c23a !important;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(103, 194, 58, 0.5);
        }

        .status-inactive {
            color: #f56c6c !important;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(245, 108, 108, 0.5);
        }

        .status-warning {
            color: #e6a23c !important;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(230, 162, 60, 0.5);
        }
        
        /* 自定义表单元素 */
        .custom-select {
            background-color: rgba(13, 32, 64, 0.6);
            border: 1px solid rgba(50, 145, 198, 0.5);
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 4px;
            width: 100%;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234dabf7' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            cursor: pointer;
        }
        
        .custom-input {
            background-color: rgba(13, 32, 64, 0.6);
            border: 1px solid rgba(50, 145, 198, 0.5);
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 4px;
            width: 100%;
        }
        
        .custom-input:focus, .custom-select:focus {
            outline: none;
            border-color: #4dabf7;
            box-shadow: 0 0 5px rgba(77, 171, 247, 0.5);
        }
        
        /* 图表容器 */
        .chart {
            width: 100%;
            height: 100%;
            min-height: 200px;
        }

        /* 对话框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s linear 0.25s, opacity 0.25s 0s;
        }

        .modal-overlay.visible {
            visibility: visible;
            opacity: 1;
            transition-delay: 0s;
        }

        .modal-container {
            background-color: rgba(6, 27, 130, 0.9);
            border: 1px solid rgba(50, 145, 198, 0.5);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 6px;
            width: 50%;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .modal-header {
            border-bottom: 1px solid rgba(50, 145, 198, 0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: #4dabf7;
            font-weight: bold;
            font-size: 18px;
        }

        .modal-close {
            color: #e0e0e0;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .modal-close:hover {
            color: #4dabf7;
        }

        .modal-body {
            padding: 20px;
            color: #e0e0e0;
        }

        .modal-footer {
            border-top: 1px solid rgba(50, 145, 198, 0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        /* 提示消息样式 */
        .message-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .message {
            background-color: rgba(6, 27, 130, 0.9);
            border: 1px solid rgba(50, 145, 198, 0.5);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 15px 20px;
            margin-bottom: 10px;
            color: #e0e0e0;
            display: flex;
            align-items: center;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .message.visible {
            transform: translateX(0);
        }

        .message.success {
            border-left: 4px solid #67c23a;
        }

        .message.error {
            border-left: 4px solid #f56c6c;
        }

        .message.info {
            border-left: 4px solid #4dabf7;
        }

        .message.warning {
            border-left: 4px solid #e6a23c;
        }

        .message i {
            margin-right: 10px;
            font-size: 18px;
        }

        .message.success i {
            color: #67c23a;
        }

        .message.error i {
            color: #f56c6c;
        }

        .message.info i {
            color: #4dabf7;
        }

        .message.warning i {
            color: #e6a23c;
        }

        /* 添加Element UI表格样式 */
        .custom-table {
            background-color: transparent !important;
            color: #e0e0e0 !important;
        }
        
        .el-table__body, .el-table__header {
            margin: 0 !important;
        }
        
        .el-table__body-wrapper {
            overflow-y: auto !important;
            background-color: transparent !important;
        }
        
        .el-table__header-wrapper {
            background-color: transparent !important;
        }
        
        .el-table::before {
            height: 0 !important;
        }
        
        .el-table__body tr:hover>td.el-table__cell {
            background-color: rgba(50, 145, 198, 0.1) !important;
        }
        
        .el-table__body tr {
            background-color: transparent !important;
        }
        
        .el-table__cell {
            border-bottom: 1px solid rgba(50, 145, 198, 0.1) !important;
            background-color: transparent !important;
        }
        
        .status-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-up {
            background-color: rgba(103, 194, 58, 0.2);
            border: 1px solid rgba(103, 194, 58, 0.5);
            color: #67c23a;
        }
        
        .status-down {
            background-color: rgba(245, 108, 108, 0.2);
            border: 1px solid rgba(245, 108, 108, 0.5);
            color: #f56c6c;
        }
        
        .action-btn {
            background: rgba(50, 145, 198, 0.2);
            color: #e0e0e0;
            border: 1px solid rgba(50, 145, 198, 0.5);
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }
        
        .btn-up {
            background-color: rgba(103, 194, 58, 0.2);
            border-color: rgba(103, 194, 58, 0.5);
            color: #67c23a;
        }
        
        .btn-up:hover {
            background-color: rgba(103, 194, 58, 0.4);
            border-color: rgba(103, 194, 58, 0.8);
        }
        
        .btn-down {
            background-color: rgba(245, 108, 108, 0.2);
            border-color: rgba(245, 108, 108, 0.5);
            color: #f56c6c;
        }
        
        .btn-down:hover {
            background-color: rgba(245, 108, 108, 0.4);
            border-color: rgba(245, 108, 108, 0.8);
        }

        /* 添加订阅表格特有的样式 */
        .status-success {
            background-color: rgba(103, 194, 58, 0.2);
            border: 1px solid rgba(103, 194, 58, 0.5);
            color: #67c23a;
        }
        
        .status-fail {
            background-color: rgba(245, 108, 108, 0.2);
            border: 1px solid rgba(245, 108, 108, 0.5);
            color: #f56c6c;
        }
        
        .btn-edit {
            background-color: rgba(50, 145, 198, 0.2);
            border-color: rgba(50, 145, 198, 0.5);
            color: #4dabf7;
        }
        
        .btn-edit:hover {
            background-color: rgba(50, 145, 198, 0.4);
            border-color: rgba(50, 145, 198, 0.8);
        }

        /* 添加播发任务表格特有的样式 */
        .status-broadcasting {
            background-color: rgba(103, 194, 58, 0.2);
            border: 1px solid rgba(103, 194, 58, 0.5);
            color: #67c23a;
        }
        
        .status-terminated {
            background-color: rgba(245, 108, 108, 0.2);
            border: 1px solid rgba(245, 108, 108, 0.5);
            color: #f56c6c;
        }

        /* 表格样式 */
        .section-content {
            /* Eliminar la altura fija y el overflow para evitar barras de desplazamiento */
            height: auto !important;
            overflow: visible !important;
        }

        .table-container {
            width: 100%;
            overflow: hidden !important; /* Prevenir barras de desplazamiento */
        }

        .el-table__body-wrapper {
            overflow: hidden !important; /* Eliminar barras de desplazamiento */
        }

        /* 表头样式调整 */
        .el-table__header-wrapper th.el-table__cell {
            background: rgba(19, 62, 151, 0.8) !important; /* #133E97 with 80% opacity */
            color: #ffffff !important; /* 更亮的白色文字 */
            border-bottom: 1px solid rgba(50, 145, 198, 0.5) !important;
            padding: 10px 12px !important;
            font-weight: bold !important; /* 加粗表头文字 */
            text-shadow: 0 0 5px rgba(77, 171, 247, 0.7) !important; /* 添加文字阴影增强可见度 */
            white-space: nowrap !important; /* 确保表头文本不换行 */
        }

        .el-table__body tr td.el-table__cell {
            padding: 6px 10px !important; /* Reducir el padding para hacer más compacto */
        }

        /* Hacer la tabla más compacta */
        .el-table {
            font-size: 13px !important;
            margin: 0 !important;
            border-collapse: collapse !important;
        }

        /* Ajustar altura de sección contenedora */
        .data-container {
            gap: 8px !important; /* Reducir espacio entre contenedores */
        }

        .section-container {
            padding: 10px !important; /* Reducir padding para hacer contenedores más compactos */
            margin-bottom: 8px !important;
        }

        .section-title {
            margin-bottom: 8px !important; /* Reducir margen */
            padding-bottom: 6px !important; /* Reducir padding */
        }

        /* 状态标签横向显示 */
        .status-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap !important; /* 防止换行 */
            text-align: center !important; /* 文本居中 */
            min-width: 64px !important; /* 确保足够宽度 */
        }
    </style>
</head>
<body>
<div class="app-container">
    <div class="top-nav">
        <div class="system-title">
            <i class="icon-fallback fas fa-satellite-dish" style="display:none;"></i>
            数据播发
        </div>
        <div class="user-info">
            <span><i class="el-icon-s-tools" style="display:none;"></i> 管理员</span>
            <button class="logout-btn"><i class="icon-fallback fas fa-sign-out-alt" style="display:none;"></i> 退出</button>
        </div>
    </div>
    
    <div class="main-wrapper">
        <!-- 左侧菜单栏 -->
        <div class="sidebar">
            <div class="menu-title"><!-- <i class="el-icon-share"></i> -->数据播发</div>
            <div class="menu-item active">
                <i class="el-icon-setting"></i>
                <span>数据播发配置</span>
            </div>
            <div class="menu-item">
                <i class="el-icon-monitor"></i>
                <span>数据播发状态监控</span>
            </div>
        </div>

        <!-- 主体内容区 -->
        <div class="main-content">
            <div class="data-container">
                <!-- 顶部两个面板水平排列 -->
                <div style="display: flex; gap: 10px; width: 100%; margin-bottom: 10px;">
                    <!-- 服务上下架管理表格 -->
                    <div class="section-container" style="flex: 1;">
                        <div class="section-title">
                            <i class="fas fa-server"></i>
                            <span>服务上下架管理</span>
                            <button class="btn btn-primary" style="margin-left: auto;" id="addServiceBtn">新增服务</button>
                        </div>
                        <div class="section-content">
                            <div class="table-container">
                                <div class="el-table custom-table el-table--fit el-table--scrollable-x el-table--enable-row-hover el-table--enable-row-transition" style="width: 100%;" id="serviceTable">
                                    <div class="el-table__header-wrapper">
                                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__header" style="width: 100%;">
                                            <colgroup>
                                                <col name="el-table_1_column_1" width="140">
                                                <col name="el-table_1_column_2" width="110"> <!-- 增加格式及协议列宽度 -->
                                                <col name="el-table_1_column_3" width="150">
                                                <col name="el-table_1_column_4" width="100">
                                                <col name="el-table_1_column_5" width="180">
                                                <col name="el-table_1_column_6" width="80">
                                            </colgroup>
                                            <thead class="has-gutter">
                                                <tr>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">来源</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">格式及协议</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">服务名称</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">服务状态</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">最新接收时间</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">操作</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div class="el-table__body-wrapper is-scrolling-left">
                                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__body" style="width: 100%;">
                                            <colgroup>
                                                <col name="el-table_1_column_1" width="140">
                                                <col name="el-table_1_column_2" width="110"> 
                                                <col name="el-table_1_column_3" width="150">
                                                <col name="el-table_1_column_4" width="100">
                                                <col name="el-table_1_column_5" width="180">
                                                <col name="el-table_1_column_6" width="80">
                                            </colgroup>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 订阅配置管理表格 -->
                    <div class="section-container" style="flex: 1;">
                        <div class="section-title">
                            <i class="fas fa-user-plus"></i>
                            <span>订阅配置管理</span>
                            <button class="btn btn-primary" style="margin-left: auto;" id="addSubscriptionBtn">新增订阅</button>
                        </div>
                        <div class="section-content">
                            <div class="table-container">
                                <div class="el-table custom-table el-table--fit el-table--enable-row-hover el-table--enable-row-transition" style="width: 100%;" id="subscriptionTable">
                                    <div class="el-table__header-wrapper">
                                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__header" style="width: 100%;">
                                            <colgroup>
                                                <col name="el-table_2_column_7" width="200">
                                                <col name="el-table_2_column_8" width="160">
                                                <col name="el-table_2_column_9" width="180">
                                                <col name="el-table_2_column_10" width="110">
                                                <col name="el-table_2_column_11" width="110">
                                            </colgroup>
                                            <thead class="has-gutter">
                                                <tr>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">订阅用户</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">订阅产品</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell" >订阅时间</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">订阅状态</div>
                                                    </th>
                                                    <th colspan="1" rowspan="1" class="el-table__cell">
                                                        <div class="cell">操作</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div class="el-table__body-wrapper is-scrolling-none">
                                        <table cellspacing="0" cellpadding="0" border="0" class="el-table__body" style="width: 100%;">
                                            <colgroup>
                                                <col name="el-table_2_column_7" width="200">
                                                <col name="el-table_2_column_8" width="160">
                                                <col name="el-table_2_column_9" width="180">
                                                <col name="el-table_2_column_10" width="110">
                                                <col name="el-table_2_column_11" width="110">
                                            </colgroup>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务配置管理表格 (单独一行) -->
                <div class="section-container">
                    <div class="section-title">
                        <i class="fas fa-tasks"></i>
                        <span>播发任务管理</span>
                        <button class="btn btn-primary" style="margin-left: auto;" id="addTaskBtn">新增任务</button>
                    </div>
                    <div class="section-content">
                        <div class="table-container">
                            <div class="el-table custom-table el-table--fit el-table--enable-row-hover el-table--enable-row-transition" style="width: 100%;" id="taskTable">
                                <div class="el-table__header-wrapper">
                                    <table cellspacing="0" cellpadding="0" border="0" class="el-table__header" style="width: 100%;">
                                        <colgroup>
                                            <col name="el-table_3_column_12" width="180">
                                            <col name="el-table_3_column_13" width="200">
                                            <col name="el-table_3_column_14" width="187">
                                            <col name="el-table_3_column_15" width="186">
                                            <col name="el-table_3_column_16" width="186">
                                            <col name="el-table_3_column_17" width="186">
                                            <col name="el-table_3_column_18" width="186">
                                            <col name="el-table_3_column_19" width="120">
                                            <col name="el-table_3_column_20" width="180">
                                        </colgroup>
                                        <thead class="has-gutter">
                                            <tr>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">任务名称</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">任务用户</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">服务产品</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">任务开始时间</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">任务结束时间</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">最新播发时间</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">已播发数据量</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">播发状态</div>
                                                </th>
                                                <th colspan="1" rowspan="1" class="el-table__cell">
                                                    <div class="cell">操作</div>
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                                <div class="el-table__body-wrapper is-scrolling-none">
                                    <table cellspacing="0" cellpadding="0" border="0" class="el-table__body" style="width: 100%;">
                                        <colgroup>
                                            <col name="el-table_3_column_12" width="180">
                                            <col name="el-table_3_column_13" width="200">
                                            <col name="el-table_3_column_14" width="187">
                                            <col name="el-table_3_column_15" width="186">
                                            <col name="el-table_3_column_16" width="186">
                                            <col name="el-table_3_column_17" width="186">
                                            <col name="el-table_3_column_18" width="186">
                                            <col name="el-table_3_column_19" width="120">
                                            <col name="el-table_3_column_20" width="180">
                                        </colgroup>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 服务对话框 -->
    <div class="modal-overlay" id="serviceModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title" id="serviceModalTitle">添加服务</div>
                <button class="modal-close" id="closeServiceModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <input type="hidden" id="serviceId">
                    <div class="form-group">
                        <label class="form-label" for="serviceName">服务名称</label>
                        <input type="text" id="serviceName" class="custom-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="serviceDesc">服务描述</label>
                        <textarea id="serviceDesc" rows="3" class="custom-input"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="serviceType">服务类型</label>
                        <select id="serviceType" class="custom-select">
                            <option value="实时播发">实时播发</option>
                            <option value="批处理播发">批处理播发</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">服务状态</label>
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="serviceStatus" style="margin-right: 10px;">
                            <label for="serviceStatus" style="margin: 0;">上架</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelServiceBtn">取 消</button>
                <button class="btn btn-primary" id="saveServiceBtn">确 定</button>
            </div>
        </div>
    </div>

    <!-- 订阅对话框 -->
    <div class="modal-overlay" id="subscriptionModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title" id="subscriptionModalTitle">添加订阅</div>
                <button class="modal-close" id="closeSubscriptionModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="subscriptionForm">
                    <input type="hidden" id="subscriptionId">
                    <div class="form-group">
                        <label class="form-label" for="subscriptionName">订阅名称</label>
                        <input type="text" id="subscriptionName" class="custom-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="username">订阅用户</label>
                        <select id="username" class="custom-select">
                            <option value="用户A">用户A</option>
                            <option value="用户B">用户B</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="subServiceName">服务名称</label>
                        <select id="subServiceName" class="custom-select">
                            <!-- 服务选项将通过JavaScript动态添加 -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">订阅状态</label>
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="subscriptionStatus" style="margin-right: 10px;">
                            <label for="subscriptionStatus" style="margin: 0;">有效</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelSubscriptionBtn">取 消</button>
                <button class="btn btn-primary" id="saveSubscriptionBtn">确 定</button>
            </div>
        </div>
    </div>

    <!-- 任务对话框 -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title" id="taskModalTitle">添加任务</div>
                <button class="modal-close" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId">
                    <div class="form-group">
                        <label class="form-label" for="taskName">任务名称</label>
                        <input type="text" id="taskName" class="custom-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="taskType">任务类型</label>
                        <select id="taskType" class="custom-select">
                            <option value="实时播发">实时播发</option>
                            <option value="批处理播发">批处理播发</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="taskServiceName">服务名称</label>
                        <select id="taskServiceName" class="custom-select">
                            <!-- 服务选项将通过JavaScript动态添加 -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="frequency">执行频率</label>
                        <select id="frequency" class="custom-select">
                            <option value="实时">实时</option>
                            <option value="每小时">每小时</option>
                            <option value="每天">每天</option>
                            <option value="每周">每周</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">任务状态</label>
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="taskStatus" style="margin-right: 10px;">
                            <label for="taskStatus" style="margin: 0;">启用</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelTaskBtn">取 消</button>
                <button class="btn btn-primary" id="saveTaskBtn">确 定</button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-container" style="width: 30%;">
            <div class="modal-header">
                <div class="modal-title">提示</div>
                <button class="modal-close" id="closeConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelConfirmBtn">取 消</button>
                <button class="btn btn-primary" id="confirmBtn">确 定</button>
            </div>
        </div>
    </div>

    <!-- 消息提示容器 -->
    <div class="message-container" id="messageContainer"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 图标加载检测与替换
    function checkElementIcons() {
        const iconElements = document.querySelectorAll('.el-icon-setting, .el-icon-monitor, .el-icon-share, .el-icon-s-tools');
        
        // 检查图标是否正确显示
        let allIconsVisible = true;
        
        iconElements.forEach(icon => {
            // 检查计算样式，如果字体未加载，宽度通常为0
            const style = window.getComputedStyle(icon);
            if (parseFloat(style.width) === 0 || parseFloat(style.height) === 0) {
                allIconsVisible = false;
                
                // 显示备用图标
                const fallbackIcon = icon.nextElementSibling;
                if (fallbackIcon && fallbackIcon.classList.contains('icon-fallback')) {
                    fallbackIcon.style.display = 'inline-block';
                    icon.style.display = 'none';
                }
            }
        });
        
        // 如果有图标不可见，使用内联SVG替换
        if (!allIconsVisible) {
            // 映射Element UI图标到Font Awesome
            const iconMapping = {
                'el-icon-setting': 'fas fa-cog',
                'el-icon-monitor': 'fas fa-desktop',
                'el-icon-share': 'fas fa-share-alt',
                's-tools': 'fas fa-tools'
            };
            
            iconElements.forEach(icon => {
                for (const [elemIcon, faIcon] of Object.entries(iconMapping)) {
                    if (icon.className.includes(elemIcon)) {
                        // 替换为Font Awesome图标
                        const fallbackIcon = document.createElement('i');
                        fallbackIcon.className = faIcon;
                        icon.parentNode.insertBefore(fallbackIcon, icon.nextSibling);
                        icon.style.display = 'none';
                        break;
                    }
                }
            });
        }
    }
    
    // 页面加载后检查图标
    setTimeout(checkElementIcons, 500);
    
    // 替换模拟数据为新的服务数据
    const services = [
        { id: 1, source: '数据接入子系统', format: 'RINEX', name: '观测数据', status: true, updateTime: '2025-03-15 08:23:45' },
        { id: 2, source: '数据接入子系统', format: 'RINEX', name: '气象数据', status: true, updateTime: '2025-03-15 09:12:33' },
        { id: 3, source: '数据接入子系统', format: 'RTCM', name: '星历数据', status: false, updateTime: '2025-02-28 14:45:12' },
        { id: 4, source: '业务处理分系统', format: 'RTCM', name: 'BDS广域增强电文组', status: true, updateTime: '2025-03-16 10:34:56' },
        { id: 5, source: '业务处理分系统', format: 'RTCM', name: '低轨广域增强电文组', status: true, updateTime: '2025-03-16 11:22:18' },
         { id: 6, source: '业务处理分系统', format: 'RTCM', name: '低轨广域增强电文组', status: true, updateTime: '2025-03-16 11:22:18' }
    ];
    
    // 更新订阅数据为新的模拟数据
    const subscriptions = [
        { id: 1, user: '分米级导航增强服务用户', products: ['区域导航增强产品'], subscribeTime: '2025-01-12 14:23:45', status: true },
        { id: 2, user: '北斗网格增强导航定位用户', products: ['广域导航增强产品'], subscribeTime: '2025-01-15 09:12:33', status: true },
        { id: 3, user: '海事搜救中心', products: ['气象数据', '区域导航增强产品'], subscribeTime: '2025-02-03 16:45:12', status: false },
        { id: 4, user: '国际搜救中心', products: ['星历数据', '广域导航增强产品'], subscribeTime: '2025-02-10 11:22:18', status: true },
        { id: 5, user: '星基增强民用平台', products: ['区域导航增强产品', '广域导航增强产品'], subscribeTime: '2025-02-18 13:28:37', status: true },
         { id: 6, user: '分米级导航增强服务用户', products: ['区域导航增强产品'], subscribeTime: '2025-01-12 14:23:45', status: true }
    ];
    
    // 更新任务数据为新的模拟数据
    const tasks = [
        { 
            id: 1, 
            name: '搜救任务', 
            users: ['海事搜救', '国际搜救'], 
            products: ['气象数据', '区域导航增强产品'],
            startTime: '2025-01-05 08:00:00',
            endTime: '2025-01-20 18:00:00',
            lastBroadcastTime: '2025-01-05 10:00:00',
            dataSize: '1000Mb',
            status: true
        },
        { 
            id: 2, 
            name: '华北地区导航定位任务', 
            users: ['分米级终端用户', '北斗网格增强导航定位终端用户'], 
            products: ['区域导航增强产品', '广域导航增强产品'],
            startTime: '2025-01-10 00:00:00',
            endTime: '2025-02-10 23:59:59',
            lastBroadcastTime: '2025-01-10 20:00:00',
            dataSize: '10.1Gb',
            status: false
        },
        { 
            id: 3, 
            name: '华东地区导航定位任务', 
            users: ['北斗网格增强导航定位终端用户'], 
            products: ['区域导航增强产品'],
            startTime: '2025-02-01 00:00:00',
            endTime: '2025-02-28 23:59:59',
            lastBroadcastTime: '2025-02-13 00:00:00',
            dataSize: '998Mb',
            status: false
        },
        { 
            id: 4, 
            name: '华北地区导航定位任务', 
            users: ['分米级终端用户', '北斗网格增强导航定位终端用户'], 
            products: ['区域导航增强产品', '广域导航增强产品'],
            startTime: '2025-01-10 00:00:00',
            endTime: '2025-02-10 23:59:59',
            lastBroadcastTime: '2025-01-10 20:00:00',
            dataSize: '10.1Gb',
            status: false
        }
    ];
    
    // DOM元素引用
    const serviceTable = document.getElementById('serviceTable').querySelector('tbody');
    const subscriptionTable = document.getElementById('subscriptionTable').querySelector('tbody');
    const taskTable = document.getElementById('taskTable').querySelector('tbody');
    
    // 模态框引用
    const serviceModal = document.getElementById('serviceModal');
    const subscriptionModal = document.getElementById('subscriptionModal');
    const taskModal = document.getElementById('taskModal');
    const confirmModal = document.getElementById('confirmModal');
    
    // 加载数据到表格
    function loadServices() {
        const serviceTableBody = document.querySelector('#serviceTable .el-table__body tbody');
        serviceTableBody.innerHTML = '';
        services.forEach(service => {
            const row = document.createElement('tr');
            row.className = 'el-table__row';
            row.style.backgroundColor = 'transparent';
            row.style.color = 'rgb(224, 224, 224)';
            
            row.innerHTML = `
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${service.source}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${service.format}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${service.name}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <span class="status-tag ${service.status ? 'status-up' : 'status-down'}">
                        ${service.status ? '已上架' : '已下架'}
                    </span>
                </div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${service.updateTime}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <button class="action-btn ${service.status ? 'btn-down' : 'btn-up'}" data-id="${service.id}">
                        ${service.status ? '下架' : '上架'}
                    </button>
                </div></td>
            `;
            serviceTableBody.appendChild(row);
        });
        
        // 添加按钮事件监听
        document.querySelectorAll('#serviceTable .action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                const service = services.find(s => s.id === id);
                showConfirm(`确定要${service.status ? '下架' : '上架'}服务"${service.name}"吗？`, () => {
                    toggleServiceStatus(id);
                });
            });
        });
    }
    
    function loadSubscriptions() {
        const subscriptionTableBody = document.querySelector('#subscriptionTable .el-table__body tbody');
        subscriptionTableBody.innerHTML = '';
        subscriptions.forEach(subscription => {
            const row = document.createElement('tr');
            row.className = 'el-table__row';
            row.style.backgroundColor = 'transparent';
            row.style.color = 'rgb(224, 224, 224)';
            
            // 创建产品列表HTML
            let productsHtml = '';
            if (subscription.products.length === 1) {
                productsHtml = `<div>${subscription.products[0]}</div>`;
            } else {
                productsHtml = '<div>';
                subscription.products.forEach(product => {
                    productsHtml += `<div>${product}</div>`;
                });
                productsHtml += '</div>';
            }
            
            row.innerHTML = `
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${subscription.user}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${productsHtml}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${subscription.subscribeTime}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <span class="status-tag ${subscription.status ? 'status-success' : 'status-fail'}">
                        ${subscription.status ? '成功订阅' : '订阅失败'}
                    </span>
                </div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <button class="action-btn btn-edit" data-id="${subscription.id}">
                        产品编辑
                    </button>
                </div></td>
            `;
            subscriptionTableBody.appendChild(row);
        });
        
        // 添加按钮事件监听
        document.querySelectorAll('#subscriptionTable .btn-edit').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                editSubscription(id);
            });
        });
    }
    
    function loadTasks() {
        const taskTableBody = document.querySelector('#taskTable .el-table__body tbody');
        taskTableBody.innerHTML = '';
        tasks.forEach(task => {
            const row = document.createElement('tr');
            row.className = 'el-table__row';
            row.style.backgroundColor = 'transparent';
            row.style.color = 'rgb(224, 224, 224)';
            
            // 创建用户列表HTML
            let usersHtml = '';
            if (task.users.length === 1) {
                usersHtml = `<div>${task.users[0]}</div>`;
            } else {
                usersHtml = '<div>';
                task.users.forEach(user => {
                    usersHtml += `<div>${user}</div>`;
                });
                usersHtml += '</div>';
            }
            
            // 创建产品列表HTML
            let productsHtml = '';
            if (task.products.length === 1) {
                productsHtml = `<div>${task.products[0]}</div>`;
            } else {
                productsHtml = '<div>';
                task.products.forEach(product => {
                    productsHtml += `<div>${product}</div>`;
                });
                productsHtml += '</div>';
            }
            
            row.innerHTML = `
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${task.name}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${usersHtml}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${productsHtml}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${task.startTime}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${task.endTime}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${task.lastBroadcastTime}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">${task.dataSize}</div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <span class="status-tag ${task.status ? 'status-broadcasting' : 'status-terminated'}">
                        ${task.status ? '正在播发' : '任务终止'}
                    </span>
                </div></td>
                <td rowspan="1" colspan="1" class="el-table__cell"><div class="cell">
                    <button class="action-btn btn-edit" data-id="${task.id}" data-action="user">
                        用户编辑
                    </button>
                    <button class="action-btn btn-edit" data-id="${task.id}" data-action="product">
                        产品编辑
                    </button>
                </div></td>
            `;
            taskTableBody.appendChild(row);
        });
        
        // 添加按钮事件监听
        document.querySelectorAll('#taskTable .btn-edit').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                const action = this.getAttribute('data-action');
                if (action === 'user') {
                    editTaskUsers(id);
                } else if (action === 'product') {
                    editTaskProducts(id);
                }
            });
        });
    }
    
    // 服务相关操作
    function editService(id) {
        const service = services.find(s => s.id === id);
        if (service) {
            document.getElementById('serviceModalTitle').textContent = '编辑服务';
            document.getElementById('serviceId').value = service.id;
            document.getElementById('serviceName').value = service.name;
            document.getElementById('serviceDesc').value = service.description || '';
            document.getElementById('serviceType').value = service.format || 'RTCM';
            document.getElementById('serviceStatus').checked = service.status;
            
            showModal(serviceModal);
        }
    }
    
    function toggleServiceStatus(id) {
        const index = services.findIndex(s => s.id === id);
        if (index !== -1) {
            services[index].status = !services[index].status;
            services[index].updateTime = getCurrentTime();
            loadServices();
            showMessage(`服务"${services[index].name}"已${services[index].status ? '上架' : '下架'}`, 'success');
        }
    }
    
    function saveService() {
        const id = document.getElementById('serviceId').value;
        const name = document.getElementById('serviceName').value.trim();
        const description = document.getElementById('serviceDesc').value.trim();
        const type = document.getElementById('serviceType').value;
        const status = document.getElementById('serviceStatus').checked;
        
        if (!name) {
            showMessage('服务名称不能为空', 'error');
            return;
        }
        
        if (id) {
            // 编辑现有服务
            const index = services.findIndex(s => s.id === parseInt(id));
            if (index !== -1) {
                const source = services[index].source; // 保留源系统
                const format = document.getElementById('serviceType').value; // 获取格式协议
                
                services[index].name = name;
                services[index].description = description;
                services[index].format = format;
                services[index].status = status;
                services[index].updateTime = getCurrentTime();
                showMessage(`服务"${name}"已更新`, 'success');
            }
        } else {
            // 新增服务
            const newId = Math.max(...services.map(s => s.id), 0) + 1;
            const format = document.getElementById('serviceType').value;
            
            services.push({
                id: newId,
                source: '数据管理分系统', // 默认来源
                format: format,
                name,
                description,
                status,
                updateTime: getCurrentTime()
            });
            showMessage(`服务"${name}"已创建`, 'success');
        }
        
        hideModal(serviceModal);
        loadServices();
        
        // 更新依赖服务的下拉选项
        updateServiceDropdowns();
    }
    
    // 订阅相关操作
    function editSubscription(id) {
        const subscription = subscriptions.find(s => s.id === id);
        if (subscription) {
            document.getElementById('subscriptionModalTitle').textContent = '编辑订阅';
            document.getElementById('subscriptionId').value = subscription.id;
            document.getElementById('subscriptionName').value = subscription.user || '';
            document.getElementById('username').value = subscription.user || '';
            
            // 更新订阅产品下拉框
            const subServiceSelect = document.getElementById('subServiceName');
            if (subscription.products && subscription.products.length > 0) {
                const firstProduct = subscription.products[0];
                if (subServiceSelect.querySelector(`option[value="${firstProduct}"]`)) {
                    subServiceSelect.value = firstProduct;
                }
            }
            
            document.getElementById('subscriptionStatus').checked = subscription.status;
            
            showModal(subscriptionModal);
        }
    }
    
    function toggleSubscriptionStatus(id) {
        const index = subscriptions.findIndex(s => s.id === id);
        if (index !== -1) {
            subscriptions[index].status = !subscriptions[index].status;
            loadSubscriptions();
            showMessage(`订阅"${subscriptions[index].user}"已${subscriptions[index].status ? '启用' : '停用'}`, 'success');
        }
    }
    
    function saveSubscription() {
        const id = document.getElementById('subscriptionId').value;
        const user = document.getElementById('username').value.trim();
        const product = document.getElementById('subServiceName').value;
        const status = document.getElementById('subscriptionStatus').checked;
        
        if (!user) {
            showMessage('订阅用户不能为空', 'error');
            return;
        }
        
        if (id) {
            // 编辑现有订阅
            const index = subscriptions.findIndex(s => s.id === parseInt(id));
            if (index !== -1) {
                // 保留原有的产品列表，更新第一个产品
                let products = subscriptions[index].products || [];
                if (product && products.length > 0) {
                    products[0] = product;
                } else if (product) {
                    products = [product];
                }
                
                subscriptions[index].user = user;
                subscriptions[index].products = products;
                subscriptions[index].status = status;
                subscriptions[index].subscribeTime = getCurrentTime();
                showMessage(`订阅"${user}"已更新`, 'success');
            }
        } else {
            // 新增订阅
            const newId = Math.max(...subscriptions.map(s => s.id), 0) + 1;
            subscriptions.push({
                id: newId,
                user,
                products: [product],
                subscribeTime: getCurrentTime(),
                status
            });
            showMessage(`订阅"${user}"已创建`, 'success');
        }
        
        hideModal(subscriptionModal);
        loadSubscriptions();
    }
    
    // 任务相关操作
    function editTask(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            document.getElementById('taskModalTitle').textContent = '编辑任务';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskName').value = task.name;
            
            // 这里需要根据实际情况来设置下拉框的值
            // 由于新数据结构不同，这里暂时使用默认值
            document.getElementById('taskType').value = '实时播发';
            
            // 默认显示第一个产品
            if (task.products && task.products.length > 0) {
                const taskServiceSelect = document.getElementById('taskServiceName');
                if (taskServiceSelect.querySelector(`option[value="${task.products[0]}"]`)) {
                    taskServiceSelect.value = task.products[0];
                }
            }
            
            document.getElementById('frequency').value = '实时';
            document.getElementById('taskStatus').checked = task.status;
            
            showModal(taskModal);
        }
    }
    
    // 新增用户编辑功能
    function editTaskUsers(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            showMessage(`编辑任务"${task.name}"的用户配置`, 'info');
            // 在实际应用中，这里应该弹出一个用户编辑的模态框
            // 由于当前页面没有这个模态框，所以只显示消息
        }
    }
    
    // 新增产品编辑功能
    function editTaskProducts(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            showMessage(`编辑任务"${task.name}"的产品配置`, 'info');
            // 在实际应用中，这里应该弹出一个产品编辑的模态框
            // 由于当前页面没有这个模态框，所以只显示消息
        }
    }
    
    function toggleTaskStatus(id) {
        const index = tasks.findIndex(t => t.id === id);
        if (index !== -1) {
            tasks[index].status = !tasks[index].status;
            loadTasks();
            showMessage(`任务"${tasks[index].name}"已${tasks[index].status ? '启动' : '停止'}`, 'success');
        }
    }
    
    function saveTask() {
        const id = document.getElementById('taskId').value;
        const name = document.getElementById('taskName').value.trim();
        const type = document.getElementById('taskType').value;
        const product = document.getElementById('taskServiceName').value;
        const frequency = document.getElementById('frequency').value;
        const status = document.getElementById('taskStatus').checked;
        
        if (!name) {
            showMessage('任务名称不能为空', 'error');
            return;
        }
        
        if (id) {
            // 编辑现有任务
            const index = tasks.findIndex(t => t.id === parseInt(id));
            if (index !== -1) {
                // 保留原有数据，只更新基本信息
                tasks[index].name = name;
                tasks[index].status = status;
                
                // 确保产品列表中包含所选产品
                if (!tasks[index].products.includes(product)) {
                    tasks[index].products.push(product);
                }
                
                showMessage(`任务"${name}"已更新`, 'success');
            }
        } else {
            // 新增任务
            const newId = Math.max(...tasks.map(t => t.id), 0) + 1;
            const now = getCurrentTime();
            const future = new Date();
            future.setDate(future.getDate() + 30); // 默认结束时间为30天后
            
            tasks.push({
                id: newId,
                name: name,
                users: ['默认用户'],
                products: [product],
                startTime: now,
                endTime: `${future.getFullYear()}-${String(future.getMonth() + 1).padStart(2, '0')}-${String(future.getDate()).padStart(2, '0')} 23:59:59`,
                lastBroadcastTime: now,
                dataSize: '0Mb',
                status: status
            });
            showMessage(`任务"${name}"已创建`, 'success');
        }
        
        hideModal(taskModal);
        loadTasks();
    }
    
    // 辅助函数
    function getCurrentTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }
    
    function updateServiceDropdowns() {
        // 更新订阅中的服务下拉列表
        const subServiceSelect = document.getElementById('subServiceName');
        subServiceSelect.innerHTML = '';
        
        // 添加可用的产品选项
        const products = [
            '区域导航增强产品',
            '广域导航增强产品',
            '气象数据',
            '星历数据'
        ];
        
        products.forEach(product => {
            const option = document.createElement('option');
            option.value = product;
            option.textContent = product;
            subServiceSelect.appendChild(option);
        });
        
        // 更新任务中的服务下拉列表
        const taskServiceSelect = document.getElementById('taskServiceName');
        taskServiceSelect.innerHTML = '';
        
        products.forEach(product => {
            const option = document.createElement('option');
            option.value = product;
            option.textContent = product;
            taskServiceSelect.appendChild(option);
        });
    }
    
    // 模态框操作
    function showModal(modal) {
        modal.classList.add('visible');
    }
    
    function hideModal(modal) {
        modal.classList.remove('visible');
    }
    
    function showConfirm(message, callback) {
        document.getElementById('confirmMessage').textContent = message;
        
        // 设置确认按钮点击事件
        const confirmBtn = document.getElementById('confirmBtn');
        const oldCallback = confirmBtn._callback;
        
        if (oldCallback) {
            confirmBtn.removeEventListener('click', oldCallback);
        }
        
        confirmBtn._callback = function() {
            callback();
            hideModal(confirmModal);
        };
        
        confirmBtn.addEventListener('click', confirmBtn._callback);
        
        showModal(confirmModal);
    }
    
    // 消息提示
    function showMessage(text, type = 'info') {
        const messageContainer = document.getElementById('messageContainer');
        const messageElement = document.createElement('div');
        messageElement.className = `message ${type}`;
        
        let iconClass = '';
        
        switch (type) {
            case 'success':
                iconClass = 'fas fa-check-circle';
                break;
            case 'error':
                iconClass = 'fas fa-times-circle';
                break;
            case 'warning':
                iconClass = 'fas fa-exclamation-triangle';
                break;
            default:
                iconClass = 'fas fa-info-circle';
        }
        
        messageElement.innerHTML = `<i class="${iconClass}"></i> ${text}`;
        messageContainer.appendChild(messageElement);
        
        // 使用RAF确保DOM更新后再添加动画类
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                messageElement.classList.add('visible');
            });
        });
        
        // 3秒后自动删除
        setTimeout(() => {
            messageElement.classList.remove('visible');
            
            // 动画结束后删除元素
            messageElement.addEventListener('transitionend', function() {
                if (messageContainer.contains(messageElement)) {
                    messageContainer.removeChild(messageElement);
                }
            });
        }, 3000);
    }
    
    // 初始化
    function init() {
        // 初始化服务
        loadServices();
        loadSubscriptions();
        loadTasks();
        updateServiceDropdowns();
        
        // 添加服务按钮
        document.getElementById('addServiceBtn').addEventListener('click', function() {
            document.getElementById('serviceModalTitle').textContent = '添加服务';
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceId').value = '';
            showModal(serviceModal);
        });
        
        // 添加订阅按钮
        document.getElementById('addSubscriptionBtn').addEventListener('click', function() {
            document.getElementById('subscriptionModalTitle').textContent = '添加订阅';
            document.getElementById('subscriptionForm').reset();
            document.getElementById('subscriptionId').value = '';
            showModal(subscriptionModal);
        });
        
        // 添加任务按钮
        document.getElementById('addTaskBtn').addEventListener('click', function() {
            document.getElementById('taskModalTitle').textContent = '添加任务';
            document.getElementById('taskForm').reset();
            document.getElementById('taskId').value = '';
            showModal(taskModal);
        });
        
        // 服务对话框事件
        document.getElementById('closeServiceModal').addEventListener('click', function() {
            hideModal(serviceModal);
        });
        
        document.getElementById('cancelServiceBtn').addEventListener('click', function() {
            hideModal(serviceModal);
        });
        
        document.getElementById('saveServiceBtn').addEventListener('click', saveService);
        
        // 订阅对话框事件
        document.getElementById('closeSubscriptionModal').addEventListener('click', function() {
            hideModal(subscriptionModal);
        });
        
        document.getElementById('cancelSubscriptionBtn').addEventListener('click', function() {
            hideModal(subscriptionModal);
        });
        
        document.getElementById('saveSubscriptionBtn').addEventListener('click', saveSubscription);
        
        // 任务对话框事件
        document.getElementById('closeTaskModal').addEventListener('click', function() {
            hideModal(taskModal);
        });
        
        document.getElementById('cancelTaskBtn').addEventListener('click', function() {
            hideModal(taskModal);
        });
        
        document.getElementById('saveTaskBtn').addEventListener('click', saveTask);
        
        // 确认对话框事件
        document.getElementById('closeConfirmModal').addEventListener('click', function() {
            hideModal(confirmModal);
        });
        
        document.getElementById('cancelConfirmBtn').addEventListener('click', function() {
            hideModal(confirmModal);
        });
        
        // 登出按钮事件
        document.querySelector('.logout-btn').addEventListener('click', function() {
            showConfirm('确定要退出系统吗？', function() {
                showMessage('您已安全退出系统', 'info');
                // 在实际应用中，这里应该跳转到登录页面
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            });
        });
        
        // 菜单项点击事件
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const isActive = this.classList.contains('active');
                
                if (!isActive) {
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    // 根据菜单显示不同的页面
                    const menuText = this.querySelector('span').textContent.trim();
                    if (menuText === '数据播发状态监控') {
                        showMessage('正在开发数据播发状态监控页面', 'info');
                        // 在实际应用中，这里应该跳转到对应的页面或加载对应的内容
                    }
                }
            });
        });
    }
    
    // 初始化应用
    init();
});
</script>
</body>
</html> 